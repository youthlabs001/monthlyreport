<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Report - 관리자</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="logo">
                <h1>📊 Monthly Report</h1>
                <span class="admin-badge">관리자</span>
            </div>
            <div class="user-info">
                <span id="adminEmail">관리자</span>
                <button class="logout-btn" id="logoutBtn">로그아웃</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-content">
            <div class="welcome-section">
                <h2>매출 데이터 관리</h2>
                <p>고객별 월간 매출 현황을 등록하고 관리합니다.</p>
            </div>

            <!-- 탭 메뉴 -->
            <div class="admin-section">
                <div class="tab-menu">
                    <button class="tab-btn active" data-tab="bulk">📋 일괄 등록 (복사/붙여넣기)</button>
                    <button class="tab-btn" data-tab="single">📝 개별 등록</button>
                </div>

                <!-- 일괄 등록 탭 -->
                <div class="tab-content active" id="bulkTab">
                    <div class="bulk-upload-section">
                        <div class="bulk-header">
                            <h4>구글 시트에서 복사/붙여넣기</h4>
                            <p>아래 형식에 맞게 구글 시트에서 데이터를 복사하여 붙여넣기 하세요.</p>
                        </div>
                        
                        <div class="format-guide">
                            <div class="guide-header">
                                <span class="guide-icon">💡</span>
                                <strong>데이터 형식 안내</strong>
                            </div>
                            <div class="guide-content">
                                <p><strong>지원 형식 (자동 인식):</strong></p>
                                <div class="guide-example">
                                    <p><strong>형식 1: YYYYMMDD, 매출액, 매출종류</strong></p>
                                    <code>20251231	136,548,330	네이버예약매출</code><br>
                                    <code>20251231	45,000,000	배달매출</code><br><br>
                                    <p><strong>형식 2: 연도, 월, 매출종류, 매출액</strong></p>
                                    <code>2025	12	네이버예약매출	136548330</code><br>
                                    <code>2025	12	배달매출	45000000</code>
                                </div>
                                <p style="margin-top: 12px; color: #64748b; font-size: 13px;">* 매출액에 쉼표(,)가 포함되어도 자동 인식됩니다.</p>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="bulkCustomerSelect">고객 선택</label>
                            <select id="bulkCustomerSelect" required>
                                <option value="">고객을 선택하세요</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="pasteArea">데이터 붙여넣기</label>
                            <textarea id="pasteArea" class="paste-area" placeholder="구글 시트에서 데이터를 복사한 후 여기에 붙여넣기 하세요 (Ctrl+V / Cmd+V)

예시:
20251231	136,548,330	네이버예약매출
20251231	45,000,000	배달매출
20251130	128,000,000	네이버예약매출
..." rows="10"></textarea>
                        </div>

                        <div class="preview-section" id="previewSection" style="display: none;">
                            <div class="preview-header">
                                <h4>📊 미리보기 (<span id="previewCount">0</span>건)</h4>
                                <button type="button" class="clear-btn" id="clearPreview">초기화</button>
                            </div>
                            <div class="preview-table-container" id="previewTable"></div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="submit-btn" id="bulkUploadBtn" disabled>일괄 등록</button>
                            <button type="button" class="reset-btn" id="clearBulkBtn">초기화</button>
                        </div>
                        <div class="message" id="bulkMessage"></div>
                        
                        <div class="upload-progress" id="uploadProgress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <p class="progress-text" id="progressText">업로드 중... 0%</p>
                        </div>
                    </div>
                </div>

                <!-- 개별 등록 탭 -->
                <div class="tab-content" id="singleTab">
                    <form id="salesForm" class="sales-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerSelect">고객 선택</label>
                                <select id="customerSelect" required>
                                    <option value="">고객을 선택하세요</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="yearSelect">연도</label>
                                <select id="yearSelect" required>
                                    <option value="2024">2024년</option>
                                    <option value="2025">2025년</option>
                                    <option value="2026" selected>2026년</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="monthSelect">월</label>
                                <select id="monthSelect" required>
                                    <option value="1">1월</option>
                                    <option value="2">2월</option>
                                    <option value="3">3월</option>
                                    <option value="4">4월</option>
                                    <option value="5">5월</option>
                                    <option value="6">6월</option>
                                    <option value="7">7월</option>
                                    <option value="8">8월</option>
                                    <option value="9">9월</option>
                                    <option value="10">10월</option>
                                    <option value="11">11월</option>
                                    <option value="12">12월</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category">매출 종류</label>
                                <input type="text" id="category" list="categoryList" placeholder="매출 종류 입력 (예: 도서판매)" required>
                                <datalist id="categoryList"></datalist>
                            </div>
                            <div class="form-group">
                                <label for="amount">매출액 (원)</label>
                                <input type="number" id="amount" placeholder="매출액을 입력하세요" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="salesCount">판매 건수 <span class="optional">(선택)</span></label>
                                <input type="number" id="salesCount" placeholder="판매 건수">
                            </div>
                            <div class="form-group">
                                <label for="note">비고 <span class="optional">(선택)</span></label>
                                <input type="text" id="note" placeholder="메모">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">매출 등록</button>
                            <button type="reset" class="reset-btn">초기화</button>
                        </div>
                        <div class="message" id="message"></div>
                    </form>
                </div>
            </div>

            <!-- 고객 목록 -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>👥 등록된 고객 목록</h3>
                    <button class="refresh-btn" id="refreshCustomers">새로고침</button>
                </div>
                <div id="customerList" class="customer-list">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- 최근 등록된 매출 -->
            <div class="admin-section">
                <div class="section-header">
                    <h3>📋 최근 등록된 매출</h3>
                    <button class="refresh-btn" id="refreshSales">새로고침</button>
                </div>
                <div id="recentSales" class="table-container">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
